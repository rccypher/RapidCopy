<!--suppress HtmlUnknownAttribute -->
<ng-template #optionsList let-header="header" let-options="options" let-id="id">
    <div class="card">
        <h3 class="card-header" id="heading-{{id}}">
            <button class="btn"
                    type="button"
                    data-toggle="collapse"
                    attr.data-target="#collapse-{{id}}">
                {{header}}
            </button>
        </h3>
        <div id="collapse-{{id}}" class="collapse" data-parent="#accordion">
            <div class="card-body">
                <div *ngFor="let option of options">
                    <app-option
                        [type]="option.type"
                        [label]="option.label"
                        [description]="option.description"
                        [value]="(config | async)?.get(option.valuePath[0]).get(option.valuePath[1])"
                        [optionDisabled]="option.enabledBy ? !(config | async)?.get(option.enabledBy[0]).get(option.enabledBy[1]) : false"
                        (changeEvent)="onSetConfig(option.valuePath[0], option.valuePath[1], $event)">
                    </app-option>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<div id="settings">
    <div id="accordion">
        <div id="left">
            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_SERVER">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_AUTOQUEUE">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_EXTRACT">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_VALIDATION">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_DISK_SPACE">
            </ng-container>

            <div class="card">
                <h3 class="card-header" id="heading-pathmappings">
                    <button class="btn"
                            type="button"
                            data-toggle="collapse"
                            data-target="#collapse-pathmappings">
                        Path Mappings
                    </button>
                </h3>
                <div id="collapse-pathmappings" class="collapse" data-parent="#accordion">
                    <div class="card-body path-mappings-body">
                        <div class="path-mappings-description">
                            Map remote server directories to local directories. Each mapping syncs files from a remote path to a local path.
                        </div>
                        <div *ngFor="let mapping of pathMappings; let i = index" class="path-mapping-row">
                            <div class="path-mapping-fields">
                                <label>
                                    <span class="name">Remote Path</span>
                                    <input type="text"
                                           class="form-control"
                                           [ngModel]="mapping.remote_path"
                                           (ngModelChange)="onPathMappingChange(i, 'remote_path', $event)" />
                                </label>
                                <label>
                                    <span class="name">Local Path</span>
                                    <input type="text"
                                           class="form-control"
                                           [ngModel]="mapping.local_path"
                                           (ngModelChange)="onPathMappingChange(i, 'local_path', $event)" />
                                </label>
                            </div>
                            <button *ngIf="pathMappings.length > 1"
                                    class="btn btn-sm btn-remove-mapping"
                                    (click)="onRemovePathMapping(i)">
                                Remove
                            </button>
                        </div>
                        <button class="btn btn-sm btn-add-mapping"
                                (click)="onAddPathMapping()">
                            + Add Path Mapping
                        </button>
                    </div>
                </div>
            </div>

        </div>
        <div id="right">
            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_CONNECTIONS">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_DISCOVERY">
            </ng-container>

            <!--suppress HtmlUnknownAttribute, UnnecessaryLabelJS -->
            <ng-container
                *ngTemplateOutlet="optionsList;context:OPTIONS_CONTEXT_OTHER">
            </ng-container>
        </div>
    </div>

    <div id="commands">
        <div class="button" appClickStopPropagation [attr.disabled]="commandsEnabled ? null : true"
             (click)="!commandsEnabled || onCommandRestart()">
            <img src="assets/icons/refresh.svg" />
            <span class="text">Restart</span>
        </div>
    </div>
</div>
